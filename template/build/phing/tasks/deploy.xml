<project name="deploy" default="build">
  <target name="deploy:build">
    <!-- deploy.build and deploy.commitMsg must be passed as params at runtime. -->
    <exec command="git checkout -b ${deploy.buildID}" logoutput="true"/>

    <!-- Add .gitignore files. -->
    <exec command="git add ${repo.root}/docroot -f" logoutput="true"/>
    <exec command="git add ${repo.root}/sites/all/themes/custom/${project.theme_name}/dist -f" logoutput="true"/>
    <exec command="git add ${repo.root}/sites/all/themes/custom/${project.theme_name}/styleguide -f" logoutput="true"/>

    <exec command="git commit -m 'Automated commit by Travis CI for Build ${deploy.buildID}' -n" logoutput="true"/>
    <foreach list="${git.remotes}" param="deploy.remote" target="deploy:push" />
  </target>
  <target name="deploy:push">
    <exec command="git remote add temp ${deploy.remote}" logoutput="true"/>
    <exec command="git push temp ${deploy.buildID}:${deploy.branch} --force" logoutput="true"/>
    <exec command="git remote remove temp" logoutput="true"/>
  </target>
</project>
