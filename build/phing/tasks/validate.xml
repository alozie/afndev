<project name="validate" default="validate:all">

  <!-- Run all validation targets. -->
  <target name="validate:all" description="Runs code validation on Drupal."
          depends="validate:lint, validate:phpcs, validate:phpmd"/>

  <!-- Run linter against all php files in repository. -->
  <target name="validate:lint" description="Runs a php lint against the codebase.">
    <phplint>
      <fileset refid="php.files"/>
    </phplint>
  </target>

  <!-- Run code sniffer against all custom code. -->
  <target name="validate:phpcs" description="Sniffs custom code to ensure it meets correct standards.">
    <phpcodesniffer
        standard="${repo.root}/vendor/drupal/coder/coder_sniffer/Drupal/"
        showSniffs="true"
        showWarnings="true"
        haltonerror="true"
        haltonwarning="true">
      <fileset refid="custom.files"/>
      <formatter type="full" usefile="false"/>
    </phpcodesniffer>

    <phpcodesniffer
        standard="PSR-4"
        showSniffs="true"
        showWarnings="true"
        haltonerror="true"
        haltonwarning="true">
      <fileset refid="test.files"/>
      <formatter type="full" usefile="false"/>
    </phpcodesniffer>
  </target>

  <!-- Run code complexity and cleanliness checks on custom code. -->
  <target name="validate:phpmd" description="Checks custom code for complexity.">
    <phpmd rulesets="codesize,unusedcode,cleancode">
      <fileset refid="custom.files"/>
      <formatter type="text" outfile="false" usefile="false"/>
    </phpmd>
  </target>
</project>
