# Note that the example .travis.yml file for child projects lives in /install.
sudo: false
language: php

php:
  - 5.5

cache:
  bundler: true
  apt: true
  directories:
  - "$HOME/.composer/cache"
  - "$HOME/.drush/cache"

notifications:
  # slack: acquia:KKfgpOkDhcO26Erv5uoZMfdP

addons:
  ssh_known_hosts:
  - svn-4702.devcloud.hosting.acquia.com

before_install:
  - composer selfupdate
  - git config --global user.name "Travis-CI"
  - git config --global user.email "noreply@travis-ci.org"
  - mysql -e 'CREATE DATABASE drupal;'

install:
  - composer install
  - export PATH=$PATH:$TRAVIS_BUILD_DIR/bin

before_script:
  # Clear drush release history cache, to pick up new releases.
  - rm -f ~/.drush/cache/download/*---updates.drupal.org-release-history-*
  # Enable $_ENV variables in PHP.
  - echo 'variables_order = "EGPCS"' >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini

script:
  # Generate a new 'bolted' project.
  - ./task.sh bolt:configure
  - ./task.sh bolt:create
  # Call targets in the new 'bolted' project.
  - ../bolted8/task.sh setup:build:all
  - ../bolted8/task.sh setup:drupal:install
  - ../bolted8/task.sh setup:git-hooks
  - ../bolted8/task.sh setup:behat
  - ../bolted8/task.sh tests:security-updates
  - ../bolted8/task.sh tests:behat -Dbehat:run-server=true
  - ../bolted8/task.sh tests:phpunit
  # Deploy build artifact.
  - ../bolted8/task.sh deploy:artifact:build
  - TEST_SUITE=bolt
  - template/scripts/deploy/travis-deploy.sh bolt 8.x 8.x-build
  # Run 'bolt' phpunit tests.
  - phpunit tests
